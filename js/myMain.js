$(function(){for(var m="\u4e91\u541e\u9762 M\u8bb0 \u70e7\u814a\u996d \u7172\u4ed4\u996d \u6c64\u996d \u732a\u811a\u996d \u997a\u5b50 \u8fa3\u5b50\u9e21".split(" "),g=m.length;g--;)localStorage.getItem("food"+g)||localStorage.setItem("food"+g,m[g]||"food");localStorage.obj||localStorage.setItem("obj","[]");localStorage.plan||localStorage.setItem("plan","[]");localStorage.hasDone||localStorage.setItem("hasDone","[]");var n=function(a){this.prizesCount=9;this.startDrawIndex=this.wonIndex=1;a&&this.setPrizesCount(a)};
n.prototype={speed:200,start:function(a){var b=this;this.speedCtrlFn=a||function(a){var d=b.speed;switch(a){case "decay":d=Math.min(d+400/this.decayDistance*this.decayIndex,600)}return d};this.startDraw()},startDraw:function(){this.drawIndex=this.startDrawIndex;this.isDrawing=!0;this.startIndex=1;this.speedState="start";this.drawing(function(){this.startIndex++;if(this.isDrawing)return!0;this.decay();return!1})},decay:function(){var a=this.wonIndex-this.decayDistance%this.prizesCount;0>=a&&(a+=this.prizesCount);
this.drawing(function(){return this.drawIndex==a?(this.decayDraw(),!1):!0})},decayDraw:function(){this.decayIndex=1;this.speedState="decay";this.drawing(function(){this.decayIndex++;return this.decayIndex>=this.decayDistance&&this.drawIndex==this.wonIndex?(this.wonCallback&&this.wonCallback(this.wonIndex),!1):!0})},setDecayDistance:function(a){this.decayDistance=a;return this},drawing:function(a,b){var c=this;window.clearTimeout(c.drawTimer);var d=b||c.speedCtrlFn.call(this,this.speedState)||200;
c.drawingCallback&&c.drawingCallback(c.drawIndex,d);a&&a.call(c)&&(c.drawTimer=window.setTimeout(function(){c.increaseDrawIndex();c.drawing(a)},d))},increaseDrawIndex:function(){this.drawIndex++;this.drawIndex>this.prizesCount&&(this.drawIndex=1)},stop:function(){this.isDrawing=!1},cancel:function(){this.stop();window.clearTimeout(this.drawTimer);this.cancelCallback&&this.cancelCallback()},setPrizesCount:function(a){this.prizesCount=a;this.setDecayDistance(Math.round(this.prizesCount/4+Math.random()*
this.prizesCount/4)||1);return this},setWonIndex:function(a){this.wonIndex=a;return this},setDrawingCallback:function(a){this.drawingCallback=a;return this},setWonCallback:function(a){this.wonCallback=a;return this},setCancelCallback:function(a){this.cancelCallback=a;return this},setspeedCallback:function(a){},setInitSpeed:function(a){this.speed=a}};var e={$container:$("#content"),_pageStack:[],_configs:[],_defaultPage:null,_isGo:!1,default:function(a){this._defaultPage=a;return this},init:function(){function a(){var a=
0===location.hash.indexOf("#")?location.hash:"#",a=b._find("url",a)||b._find("name",b._defaultPage);switch(a.name){case "home":b.go(a.name,{"#Name":localStorage.uName||"\u4f60\u7684\u6635\u79f0"});break;case "eat":b.go(a.name,b.goEat());break;case "note":b.go(a.name,{"#event":b.goPlan()});break;case "dataPlan":b.go(a.name,{".goingToDo":b.goDatePlan(),".ThingHasDone":b.goDatePlanHasDone()});break;case "holiday":b.go(a.name,{".pageTitle":b.getDate(!0),".pageSecondTitle":b.getDate()});break;default:b.go(a.name)}}
var b=this;$(window).on("hashchange",function(c){c=!b._isGo;b._isGo=!1;if(c){c=0===location.hash.indexOf("#")?location.hash:"#";for(var d=null,e=0,g=b._pageStack.length;e<g;e++){var f=b._pageStack[e];if(f.config.url===c){d=f;break}}d?b.back():a()}});a();console.log(b._pageStack);return this},push:function(a){this._configs.push(a);return this},go:function(a,b){var c=this._find("name",a);if(c){var d=$(c.template).html(),d=$(d).addClass("slideIn").addClass(c.name);b&&this.matchStorage(d,b);this.$container.append(d);
this._pageStack.push({config:c,dom:d});this._isGo=!0;location.hash=c.url;c.isBind||this._bind(c);return this}},matchStorage:function(a,b){for(var c in b)switch(c){case "foodId":console.log(b[c]);localStorage.foodId=b[c];a.find("#testEdit").val(localStorage.getItem("food"+localStorage.foodId)||"\u65e0");break;case "menuId":$("#pageEat .weui_grid:not(.begin)").eq(localStorage.foodId).find(".weui_grid_label").html(localStorage.getItem("food"+localStorage.foodId));break;case "thingId":a.find("#DayPlanEdit3").val(b[c][2]);
a.find("#DayPlanEdit4").val(b[c][3]);b[c][0]?a.find(".confirm").data("id",b[c][1]):a.find(".confirm").data("idDone",b[c][1]);break;default:a.find(c).html(b[c])}return a},back:function(a){var b=this._pageStack.pop();if(b){b.dom.addClass("slideOut").on("animationend",function(){b.dom.remove()}).on("webkitAnimationEnd",function(){b.dom.remove()});a=this._pageStack[this._pageStack.length-1];switch(a.config.name){case "home":this.matchStorage(a.dom,{"#Name":localStorage.uName||"\u4f60\u7684\u6635\u79f0"});
break;case "eat":this.matchStorage(a.dom,{menuId:localStorage.foodId||0});break;case "note":this.matchStorage(a.dom,{"#event":this.goPlan()});break;case "dataPlan":this.matchStorage(a.dom,{".goingToDo":this.goDatePlan(),".ThingHasDone":this.goDatePlanHasDone()});break;case "holiday":this.matchStorage(a.dom,{".pageTitle":this.getDate(!0),".pageSecondTitle":this.getDate()})}return this}},_find:function(a,b){for(var c=null,d=0,e=this._configs.length;d<e;d++)if(this._configs[d][a]===b){c=this._configs[d];
break}return c},_bind:function(a){var b=a.events||{},c;for(c in b)for(var d in b[c])this.$container.on(d,c,b[c][d]);a.isBind=!0},goEat:function(){for(var a={},b=8;b--;)a[".food"+(b+1)]=localStorage.getItem("food"+b);return a},goPlan:function(){for(var a="",b=JSON.parse(localStorage.obj),c=0,d=b.length;c<d;c++)a+='<a class="weui_cell NoteThing" href="javascript:;">\r\n                    <div class="weui_cell_bd weui_cell_primary">\r\n                    <p>'+b[c].content+'</p>\r\n                    </div>\r\n                    <div class="weui_cell_ft">\r\n                    </div>\r\n                    </a>';
return a},goDatePlan:function(){var a="",b=JSON.parse(localStorage.plan);0===b.length&&(a+="&nbsp;&nbsp;&nbsp;&nbsp;\u627e\u70b9\u4e8b\u505a\u256e(\u256f\u25bd\u2570)\u256d");for(var c=0,d=b.length;c<d;c++)a+='<a class="weui_cell ThingItem" href="javascript:;">\r\n                 <div class="weui_cell_hd">\r\n                    <i class="weui_icon_waiting"></i>\r\n                    </div>\r\n                    <div class="weui_cell_bd weui_cell_primary">\r\n                    <p>'+b[c].content+
'</p>\r\n                    </div>\r\n                    <div class="weui_cell_ft">'+b[c].content2+"</div>\r\n                    </a>";return a},goDatePlanHasDone:function(){for(var a="",b=JSON.parse(localStorage.hasDone),c=0,d=b.length;c<d;c++)a+='<a class="weui_cell ThingItemDone" href="javascript:;">\r\n                 <div class="weui_cell_hd">\r\n                    <i class="weui_icon_success"></i>\r\n                    </div>\r\n                    <div class="weui_cell_bd weui_cell_primary">\r\n                    <p>'+
b[c].content+'</p>\r\n                    </div>\r\n                    <div class="weui_cell_ft">'+b[c].content2+"</div>\r\n                    </a>";return a},getDate:function(a){var b=(new Date).getDay();return a?"\u4eca\u5929\u662f"+"\u661f\u671f\u65e5 \u661f\u671f\u4e00 \u661f\u671f\u4e8c \u661f\u671f\u4e09 \u661f\u671f\u56db \u661f\u671f\u4e94 \u661f\u671f\u516d".split(" ")[b]:1<=b&&5>=b?"\u7406\u8bba\u4e0a\u8fd8\u6709"+(6-b)+"\u5929\u653e\u5047":"\u4eca\u5929\u653e\u5047\u5566~~\uff01\uff01"}},
p=function(){var a=localStorage.getItem("obj")||"";return a?JSON.parse(a):[]},f=function(){var a=localStorage.getItem("plan")||"";return a?JSON.parse(a):[]},k=function(){var a=localStorage.getItem("hasDone")||"";return a?JSON.parse(a):[]},h=function(a,b){a.removeClass("weui_actionsheet_toggle");b.removeClass("weui_fade_toggle");a.on("transitionend",function(){b.hide()}).on("webkitTransitionEnd",function(){b.hide()})},l=function(a,b,c){var d=$("#dialog1");d.find(".weui_dialog_title").html(a);d.find(".weui_dialog_bd").html(b);
d.removeClass("hide");d.find(".default").off("click").on("click",function(){d.addClass("hide")});d.find(".primary").off("click").on("click",function(){d.addClass("hide");c&&c()})};e.push({name:"home",url:"#",template:"#tpl_home",events:{".weui_grid":{click:function(a){a=$(this).data("id");switch(a){case "eat":e.go(a,e.goEat());break;case "note":e.go(a,{"#event":e.goPlan()});break;case "dataPlan":e.go(a,{".goingToDo":e.goDatePlan(),".ThingHasDone":e.goDatePlanHasDone()});break;case "holiday":e.go(a,
{".pageTitle":e.getDate(!0),".pageSecondTitle":e.getDate()});break;default:e.go(a)}}},"#Name":{click:function(a){e.go("edit",{"#editTitle":"\u7f16\u8f91\u6635\u79f0"})}}}}).push({name:"eat",url:"#eat",template:"#tpl_eat",events:{".begin":{click:function(a){var b=this,c=new n(8);c.setDrawingCallback(function(a,c){var e=".icon"+a;console.log(e,c);$(b).siblings(e).addClass("active").siblings().removeClass("active")});c.setInitSpeed(100);c.setDecayDistance(10+Math.round(3*Math.random()));c.start();setTimeout(function(){console.log("finish!");
c.setWonIndex(8*Math.random()+1<<0);c.stop()},2E3)}},"#pageEat .weui_grid:not(.begin)":{click:function(a){a=$(this).index("#pageEat .weui_grid:not(.begin)");e.go("edit",{"#editTitle":"\u7f16\u8f91\u98df\u7269",foodId:a})}}}}).push({name:"dataPlan",url:"#dataPlan",template:"#tpl_dataPlan",events:{"#commitMenu":{click:function(a){var b=$("#mask"),c=$("#weui_actionsheet");c.addClass("weui_actionsheet_toggle");b.show().addClass("weui_fade_toggle").off("click").on("click",function(){h(c,b)});$("#actionsheet_cancel").off("click").on("click",
function(){console.log("h");h(c,b)});c.unbind("transitionend").unbind("webkitTransitionEnd")}},"#actionsheet_add":{click:function(a){a=$("#mask");var b=$("#weui_actionsheet");e.go("editPlan");h(b,a)}},"#actionsheet_deleteAll":{click:function(a){a=$("#mask");var b=$("#weui_actionsheet");h(b,a);l("\u6e05\u7a7a\u8ba1\u5212","\u786e\u5b9a\u6e05\u7a7a\u6240\u6709\u65e5\u7a0b\u8ba1\u5212\uff1f",function(){localStorage.setItem("plan","[]");localStorage.setItem("hasDone","[]");e.matchStorage($("#DATA"),{".goingToDo":e.goDatePlan()});
e.matchStorage($("#DATA"),{".ThingHasDone":e.goDatePlanHasDone()})})}},".ThingItem":{click:function(a){e.go("editPlanItem",{thingId:[1,$(this).index(),$(this).find("p").html(),$(this).find(".weui_cell_ft").html()]})}},".ThingItemDone":{click:function(a){e.go("editPlanItem",{"#ItemDone":"NotDone",thingId:[0,$(this).index(),$(this).find("p").html(),$(this).find(".weui_cell_ft").html()]})}}}}).push({name:"note",url:"#note",template:"#tpl_note",events:{"#AddEvent":{click:function(a){if(a=$.trim($("#eventInput").val())){var b=
p();b.push({content:a});localStorage.obj=JSON.stringify(b);e.matchStorage($("#notePage"),{"#event":e.goPlan()});$("#eventInput").val("")}}},".NoteThing":{click:function(a){var b=$(this).index();l("\u5220\u9664\u4e8b\u9879","\u786e\u5b9a\u5220\u9664\u6b64\u5907\u5fd8\u9879\uff1f",function(){var a=p()||[];a.splice(b,1);localStorage.setItem("obj",JSON.stringify(a));e.matchStorage($("#notePage"),{"#event":e.goPlan()})})}}}}).push({name:"holiday",url:"#holiday",template:"#tpl_holiday"}).push({name:"mirror",
url:"#mirror",template:"#tpl_mirror",events:{"#showDialog":{click:function(a){l("\u955c\u5b50\u529f\u80fd","\u8bf7\u6309\u4e0b\u9501\u5c4f\u952e\uff0c\u6fc0\u6d3b\u7cfb\u7edf\u955c\u5b50\u529f\u80fd")}}}}).push({name:"edit",url:"#edit",template:"#tpl_edit",events:{"#commit":{click:function(a){if(a=e._pageStack[e._pageStack.length-2]){var b=$("#testEdit").val();if($.trim(b))switch(a.config.name){case "home":localStorage.uName=b||"your name";break;case "eat":localStorage.setItem("food"+localStorage.foodId,
b||"food")}window.history.go(-1)}else return!1}}}}).push({name:"editPlan",url:"#editPlan",template:"#tpl_editPlan",events:{"#DayPlanCommit":{click:function(a){a=$.trim($("#DayPlanEdit").val());var b=$.trim($("#DayPlanEdit2").val());console.log("step1 ",a);if(a){var c=f();console.log("step2 ",a);c.push({content:a,content2:b||""});localStorage.plan=JSON.stringify(c);window.history.go(-1)}}}}}).push({name:"editPlanItem",url:"#editPlanItem",template:"#tpl_editPlanItem",events:{"#ItemDelete":{click:function(a){a=
$(this).closest(".confirm");var b=f()||[],c=k()||[];a.data("id")||0===a.data("id")?(b.splice(a.data("id"),1),localStorage.setItem("plan",JSON.stringify(b))):(c.splice(a.data("idDone"),1),localStorage.setItem("hasDone",JSON.stringify(c)));window.history.go(-1)}},"#ItemDone":{click:function(a){var b=$(this).closest(".confirm");a=f()||[];var c=k()||[];b.data("id")||0===b.data("id")?(b=a.splice(b.data("id"),1)[0],c.push(b)):a.push(c.splice(b.data("idDone"),1)[0]);localStorage.setItem("hasDone",JSON.stringify(c));
localStorage.setItem("plan",JSON.stringify(a));window.history.go(-1)}},"#ItemCommit":{click:function(a){a=$(this).closest(".confirm");var b=f()||[],c=k()||[],d=$.trim($("#DayPlanEdit3").val()),e=$.trim($("#DayPlanEdit4").val());console.log(a.data("id"));a.data("id")||0===a.data("id")?(console.log("\u4fee\u6539notDone"),d&&(console.log(d,e,a.data("id"),b),b[a.data("id")]={content:d,content2:e||""},localStorage.setItem("plan",JSON.stringify(b)))):(console.log("\u4fee\u6539done"),d&&(console.log("\u4fee\u6539done2"),
c[a.data("idDone")]={content:d,content2:e||""},localStorage.setItem("hasDone",JSON.stringify(c))));window.history.go(-1)}}}}).push({name:"chooser",url:"#chooser",template:"#tpl_chooser",events:{".center":{click:function(a){if(window.doing)return!1;var b=$(".circleOut"),c=$(".circleIn"),d=$(".C-btn"),e=.45<Math.random()?"left":"right";console.log(e);window.doing=!0;b.removeClass("left right");c.removeClass("S-left S-right");window.clock2=setTimeout(function(){clearTimeout(window.clock2);d.html("Wait");
b.addClass(e);c.addClass("S-"+e)},50);window.clock=setTimeout(function(){clearTimeout(window.clock);d.html("Click");window.doing=!1},4E3)}}}}).default("home").init()});